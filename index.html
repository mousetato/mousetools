<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>计时器</title>
    
    <link rel="manifest" href="manifest.json">
    
    <style>
        /* [样式代码保持不变，为节省篇幅此处省略] */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a1a2e;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .timer-section {
            width: 90%;
            max-width: 450px;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 15px;
            background-color: #0f3460;
            text-align: center;
        }
        h2 { margin-bottom: 15px; font-size: 1.5rem; color: #ffcc00; }
        .display-time { font-size: 4rem; font-weight: bold; font-variant-numeric: tabular-nums; margin-bottom: 10px; color: #b8c2ff; }
        .counter-display { font-size: 1.8rem; margin-bottom: 20px; color: #90ee90; }
        #coffeeMessage { font-size: 1.5rem; color: #ff5252; font-weight: bold; height: 30px; margin-top: 10px; }
        .controls { display: flex; justify-content: center; gap: 10px; }
        button { padding: 12px 25px; font-size: 1.1rem; border: none; border-radius: 50px; cursor: pointer; transition: background-color 0.2s, transform 0.1s; }
        .btn-start { background-color: #00e676; color: #000; }
        .btn-pause { background-color: #ff9800; color: #fff; }
        .btn-reset { background-color: #f44336; color: #fff; }
        .btn-set { background-color: #2196f3; color: #fff; }
        input { padding: 10px; margin-right: 10px; border: none; border-radius: 5px; width: 80px; text-align: center; }
    </style>
</head>
<body>

    <div class="timer-section" id="stopwatch-container">
        <h2>工作计时 (正计时)</h2>
        <div class="display-time" id="stopwatch-time">00:00:00</div>
        <div class="counter-display" id="interval-counter">计数: 0</div>
        <div class="controls">
            <button class="btn-start" onclick="toggleStopwatch()" id="stopwatchBtn">开始</button>
            <button class="btn-reset" onclick="resetStopwatch()">重置</button>
        </div>
    </div>

    <div class="timer-section" id="coffee-timer-container">
        <h2>咖啡钟 (倒计时)</h2>
        <div style="margin-bottom: 15px;">
            <input type="number" id="coffee-input" value="150" placeholder="秒数 (默认 150)">
            <button class="btn-set" onclick="setCoffeeTime()">设置时间</button>
        </div>
        <div class="display-time" id="coffee-timer-display">02:30</div>
        <div id="coffeeMessage"></div>
        <div class="controls">
            <button class="btn-start" onclick="toggleCoffeeTimer()" id="coffeeBtn">开始</button>
            <button class="btn-reset" onclick="resetCoffeeTimer()">重置</button>
        </div>
    </div>

    <script>
        // [JavaScript 函数代码保持不变，为节省篇幅此处省略]
        // 确保你的所有 JS 函数都在这里

        // --- 所有 JS 函数 (toggleStopwatch, resetStopwatch, toggleCoffeeTimer, etc.) 放在此处 ---
        
        let totalSeconds = 0; let stopwatchId = null; let isStopwatchRunning = false; const INTERVAL_DURATION = 1200; 
        function formatStopwatchTime(sec) { const h = Math.floor(sec / 3600); const m = Math.floor((sec % 3600) / 60); const s = sec % 60; return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`; }
        function updateStopwatchDisplay() { const timeDisplay = document.getElementById('stopwatch-time'); const counterDisplay = document.getElementById('interval-counter'); timeDisplay.textContent = formatStopwatchTime(totalSeconds); const counter = Math.floor(totalSeconds / INTERVAL_DURATION); counterDisplay.textContent = `计数: ${counter}`; }
        function toggleStopwatch() { const btn = document.getElementById('stopwatchBtn'); if (isStopwatchRunning) { clearInterval(stopwatchId); isStopwatchRunning = false; btn.textContent = "继续"; btn.className = "btn-start"; } else { isStopwatchRunning = true; btn.textContent = "暂停"; btn.className = "btn-pause"; stopwatchId = setInterval(() => { totalSeconds++; updateStopwatchDisplay(); }, 1000); } }
        function resetStopwatch() { clearInterval(stopwatchId); isStopwatchRunning = false; totalSeconds = 0; updateStopwatchDisplay(); const btn = document.getElementById('stopwatchBtn'); btn.textContent = "开始"; btn.className = "btn-start"; }
        
        let coffeeTimeLeft = 150; let coffeeTimerId = null; let isCoffeeRunning = false; let initialCoffeeTime = 150;
        function formatCountdownTime(sec) { const m = Math.floor(sec / 60); const s = sec % 60; return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`; }
        function updateCoffeeDisplay() { document.getElementById('coffee-timer-display').textContent = formatCountdownTime(coffeeTimeLeft); }
        function setCoffeeTime() { const inputElement = document.getElementById('coffee-input'); const inputSec = parseInt(inputElement.value); if (!isNaN(inputSec) && inputSec > 0) { clearInterval(coffeeTimerId); isCoffeeRunning = false; initialCoffeeTime = inputSec; coffeeTimeLeft = initialCoffeeTime; updateCoffeeDisplay(); document.getElementById('coffeeMessage').textContent = ""; const btn = document.getElementById('coffeeBtn'); btn.textContent = "开始"; btn.className = "btn-start"; } else { alert("请输入有效的秒数！"); } }
        function resetCoffeeTimer() { clearInterval(coffeeTimerId); isCoffeeRunning = false; coffeeTimeLeft = initialCoffeeTime; const btn = document.getElementById('coffeeBtn'); btn.textContent = "开始"; btn.className = "btn-start"; document.getElementById('coffeeMessage').textContent = ""; updateCoffeeDisplay(); }
        function toggleCoffeeTimer() { const btn = document.getElementById('coffeeBtn'); if (isCoffeeRunning) { clearInterval(coffeeTimerId); isCoffeeRunning = false; btn.textContent = "继续"; btn.className = "btn-start"; } else { if (coffeeTimeLeft <= 0) { coffeeTimeLeft = initialCoffeeTime; updateCoffeeDisplay(); } isCoffeeRunning = true; btn.textContent = "暂停"; btn.className = "btn-pause"; document.getElementById('coffeeMessage').textContent = ""; coffeeTimerId = setInterval(() => { if (coffeeTimeLeft > 0) { coffeeTimeLeft--; updateCoffeeDisplay(); } else { clearInterval(coffeeTimerId); isCoffeeRunning = false; btn.textContent = "完成"; btn.className = "btn-reset"; new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3').play(); document.getElementById('coffeeMessage').textContent = "☕ 咖啡时间到！请享用。"; } }, 900); } }
        
        updateStopwatchDisplay();
        updateCoffeeDisplay();


        // PWA: Service Worker 注册脚本 (必须放在 JS 代码的最后)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>

</body>
</html>