<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>ğŸ­è®¡æ—¶å™¨</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* ======================================================= */
        /* 1. åŸºç¡€æ ·å¼ä¸å±…ä¸­å¸ƒå±€ - ç™½åº•ä¸åœ†æ¶¦å­—ä½“ */
        /* ======================================================= */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Quicksand', 'Helvetica Neue', 'Arial', sans-serif; /* åœ†æ¶¦å­—ä½“ */
            background-color: #f0f2f5; /* ææµ…ç°ç™½åº• */
            color: #333333; /* æ–‡å­—é¢œè‰²æ”¹ä¸ºæ·±è‰² */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center; 
            padding: 20px 0; 
        }

        .app-container {
            width: 95%;
            max-width: 500px;
            background-color: #ffffff; /* çº¯ç™½å¡ç‰‡ */
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* æŸ”å’Œçš„é˜´å½± */
            padding-bottom: 20px;
        }

        /* ======================================================= */
        /* 2. Tab åˆ‡æ¢æ ·å¼ */
        /* ======================================================= */
        .tabs {
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab-button {
            flex-grow: 1;
            padding: 15px 10px;
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            color: #666; /* éæ¿€æ´» Tab é¢œè‰² */
            background-color: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: #E91E63; /* æ¿€æ´» Tab é¢œè‰²ï¼ˆäº®çœ¼çš„ç²‰è‰²ï¼‰ */
            border-bottom: 3px solid #E91E63;
        }

        .tab-content {
            padding: 0 20px;
            text-align: center;
        }

        /* ======================================================= */
        /* 3. è®¡æ—¶å™¨é€šç”¨æ ·å¼ */
        /* ======================================================= */
        h2 {
            margin-bottom: 15px;
            color: #333333; 
            padding-bottom: 15px;
        }

        .display-time {
            font-family: 'Orbitron', monospace;
            font-size: 3.5rem; 
            font-weight: 700;
            color: #4CAF50;
            text-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        
        #interval-counter {
            font-size: 1.5rem;
            color: #666;
            margin-bottom: 20px;
        }

        /* æŒ‰é’®é€šç”¨æ ·å¼ (è°ƒæ•´ä¸ºæµ…è‰²èƒŒæ™¯ä¸‹çš„é¢œè‰²) */
        .controls {
            display: flex; justify-content: center; gap: 10px; margin-top: 20px; margin-bottom: 20px;
        }

        button {
            padding: 12px 25px; font-size: 1.1rem; border-radius: 50px; border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* æŸ”å’Œé˜´å½± */
            transition: all 0.2s ease-in-out; cursor: pointer;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15); }
        button:active { transform: scale(0.95); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .btn-start { background-color: #00e676; color: #000; }
        .btn-pause { background-color: #ff9800; color: #fff; }
        .btn-reset { background-color: #f44336; color: #fff; }
        .btn-set { background-color: #2196f3; color: #fff; }
        input { padding: 10px; margin-right: 10px; border: 1px solid #ccc; border-radius: 5px; width: 80px; text-align: center; color: #000;}

        /* ======================================================= */
        /* 4. å’–å•¡æ¯å½¢çŠ¶ (åœ†å½¢ç“·æ¯) */
        /* ======================================================= */
        .coffee-cup-container {
            position: relative;
            width: 250px;
            height: 180px;
            margin: 30px auto 10px auto;
        }
        
        .cup-body {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 120px;
            
            /* ç“·ç™½è‰²ä¸»ä½“ï¼Œåœ†æ¶¦åº•éƒ¨ */
            background-color: #F8F8FF; /* ç“·ç™½è‰² */
            border: 1px solid #E0E0E0;
            border-radius: 0 0 30px 30px; 
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05); /* æŸ”å’Œå†…é˜´å½±ï¼Œå¢åŠ ç«‹ä½“æ„Ÿ */
        }

        /* æ¯æ²¿ (Rim) */
        .cup-body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: #E0E0E0; /* æµ…ç°è‰²æ¯æ²¿ */
            border-radius: 10px 10px 0 0;
        }

        /* æ¯æŸ„ (Handle) */
        .cup-body::after {
            content: '';
            position: absolute;
            right: -30px;
            top: 20px;
            width: 50px;
            height: 80px;
            border: 10px solid #E0E0E0; /* ç“·ç™½è‰²æŠŠæ‰‹ */
            border-radius: 0 50px 50px 0;
            border-left: none;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* å’–å•¡æ¶² (Liquid) */
        .coffee-liquid {
            position: absolute;
            top: 5px; 
            width: 100%;
            height: 100%;
            background-color: #4E342E; /* æ·±æ£•è‰² */
            border-radius: 0 0 30px 30px;
            z-index: 10;
        }
        
        /* è°ƒæ•´è®¡æ—¶å™¨å’Œæ¶ˆæ¯çš„å®šä½ */
        #coffee-timer-display {
            position: absolute; width: 100%; text-align: center; color: #fff; z-index: 20; 
            font-size: 2.5rem; left: 50%; transform: translateX(-50%);
            top: 35px; 
        }
        #coffeeMessage {
            position: absolute; width: 100%; text-align: center; color: #FFCDD2; z-index: 20;
            font-size: 1rem; left: 50%; transform: translateX(-50%);
            top: 85px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        
        <div class="tabs">
            <button class="tab-button active" data-tab="work">Work Timer (æ­£è®¡æ—¶)</button>
            <button class="tab-button" data-tab="coffee">Coffee Timer (å’–å•¡é’Ÿ)</button>
        </div>
        
        <div id="work" class="tab-content active">
            <h2>å·¥ä½œè®¡æ—¶</h2>
            <div class="display-time" id="stopwatch-time">00:00:00</div>
            <div id="interval-counter">è®¡æ•°: 0</div>
            <div class="controls">
                <button class="btn-start" onclick="toggleStopwatch()" id="stopwatchBtn">å¼€å§‹</button>
                <button class="btn-reset" onclick="resetStopwatch()">é‡ç½®</button>
            </div>
        </div>
        
        <div id="coffee" class="tab-content" style="display: none;">
            <h2>å’–å•¡é’Ÿ</h2>
            
            <div style="margin-bottom: 15px;">
                <input type="number" id="coffee-input" value="150" placeholder="ç§’æ•° (é»˜è®¤ 150)">
                <button class="btn-set" onclick="setCoffeeTime()">è®¾ç½®æ—¶é—´</button>
            </div>
            
            <div class="coffee-cup-container">
                <div class="cup-body">
                    <div class="coffee-liquid">
                        <div class="display-time" id="coffee-timer-display">02:30</div>
                        <div id="coffeeMessage"></div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn-start" onclick="toggleCoffeeTimer()" id="coffeeBtn">å¼€å§‹</button>
                <button class="btn-reset" onclick="resetCoffeeTimer()">é‡ç½®</button>
            </div>
        </div>
    </div>
    
    <script>
        // =======================================================
        // 1. Tab åˆ‡æ¢é€»è¾‘ (ä¿æŒä¸å˜)
        // =======================================================
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTabId = button.dataset.tab;
                switchTab(targetTabId);
            });
        });

        function switchTab(targetTabId) {
            // æš‚åœå½“å‰çš„è®¡æ—¶å™¨ï¼Œä»¥é˜²åå°è¿è¡Œ
            if (targetTabId === 'coffee' && isStopwatchRunning) {
                toggleStopwatch(); // æš‚åœå·¥ä½œè®¡æ—¶
            } else if (targetTabId === 'work' && isCoffeeRunning) {
                toggleCoffeeTimer(); // æš‚åœå’–å•¡é’Ÿ
            }

            // æ›´æ–°æŒ‰é’®æ ·å¼
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-button[data-tab="${targetTabId}"]`).classList.add('active');

            // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
            tabContents.forEach(content => {
                content.style.display = 'none';
                if (content.id === targetTabId) {
                    content.style.display = 'block';
                }
            });
        }

        // =======================================================
        // 2. è®¡æ—¶å™¨æ ¸å¿ƒé€»è¾‘ (å·²ä¿®æ­£è¯¯å·®)
        // =======================================================
        
        // --- Work Timer ---
        let stopwatchId = null; 
        let isStopwatchRunning = false;
        let stopwatchStartTime = 0; // è®°å½•å¼€å§‹æ—¶é—´ (æ¯«ç§’)
        let stopwatchOffset = 0;    // è®°å½•æš‚åœæ—¶çš„ç´¯è®¡æ—¶é—´ (æ¯«ç§’)
        const INTERVAL_DURATION = 1200; // 20 åˆ†é’Ÿ = 1200 ç§’
        
        function formatStopwatchTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function updateStopwatchDisplay() {
            // æ ¸å¿ƒé€»è¾‘ï¼šè®¡ç®—æ€»æµé€æ—¶é—´
            let totalTimeMs = stopwatchOffset;
            if (isStopwatchRunning) {
                 totalTimeMs += Date.now() - stopwatchStartTime;
            }

            const totalSeconds = Math.floor(totalTimeMs / 1000);
            const timeDisplay = document.getElementById('stopwatch-time');
            const counterDisplay = document.getElementById('interval-counter');

            timeDisplay.textContent = formatStopwatchTime(totalTimeMs);
            
            const counter = Math.floor(totalSeconds / INTERVAL_DURATION);
            counterDisplay.textContent = `è®¡æ•°: ${counter}`;
        }

        function toggleStopwatch() {
            const btn = document.getElementById('stopwatchBtn');
            if (isStopwatchRunning) {
                // æš‚åœ: ç´¯åŠ å½“å‰è¿è¡Œæ—¶é—´åˆ° offset
                clearInterval(stopwatchId);
                isStopwatchRunning = false;
                stopwatchOffset += Date.now() - stopwatchStartTime; // å…³é”®ï¼šä¿å­˜æµé€æ—¶é—´
                btn.textContent = "ç»§ç»­";
                btn.className = "btn-start";
            } else {
                // å¼€å§‹/ç»§ç»­
                stopwatchStartTime = Date.now(); // å…³é”®ï¼šè®°å½•æ–°çš„å¼€å§‹æ—¶é—´
                isStopwatchRunning = true;
                btn.textContent = "æš‚åœ";
                btn.className = "btn-pause";
                
                stopwatchId = setInterval(() => {
                    updateStopwatchDisplay(); // æ¯æ¬¡æ›´æ–°æ—¶éƒ½åŸºäº Date.now() é‡æ–°è®¡ç®—æ—¶é—´
                }, 1000);
            }
            updateStopwatchDisplay(); // ç«‹å³æ›´æ–°æ˜¾ç¤º
        }

        function resetStopwatch() {
            clearInterval(stopwatchId);
            isStopwatchRunning = false;
            stopwatchOffset = 0; // é‡ç½®ç´¯è®¡æ—¶é—´
            stopwatchStartTime = 0;
            updateStopwatchDisplay();
            
            const btn = document.getElementById('stopwatchBtn');
            btn.textContent = "å¼€å§‹";
            btn.className = "btn-start";
        }

        // --- Coffee Timer ---
        let coffeeTimerId = null;
        let isCoffeeRunning = false;
        let initialCoffeeTime = 150; // åˆå§‹è®¾å®šæ—¶é—´ (ç§’)
        let coffeeTimeTotalMs = 0;  // è®¾å®šæ—¶é—´æ€»æ¯«ç§’æ•° (ç”¨äºè®¡ç®—ç™¾åˆ†æ¯”)
        let coffeeStartTime = 0; // è®¡æ—¶å¼€å§‹æ—¶é—´ (æ¯«ç§’)
        let coffeeTimePausedOffset = 0; // æš‚åœæ—¶çš„æµé€æ—¶é—´ (æ¯«ç§’)

        function formatCountdownTime(ms) {
            const totalSeconds = Math.ceil(ms / 1000); // å‘ä¸Šå–æ•´ï¼Œç¡®ä¿å€’è®¡æ—¶åˆ°0
            if (totalSeconds < 0) return "00:00";
            const m = Math.floor(totalSeconds / 60);
            const s = totalSeconds % 60;
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        
        function updateCoffeeDisplay() {
            const btn = document.getElementById('coffeeBtn');
            const messageElement = document.getElementById('coffeeMessage');
            
            let timeElapsedMs = coffeeTimePausedOffset;
            if (isCoffeeRunning) {
                timeElapsedMs += Date.now() - coffeeStartTime;
            }

            let coffeeTimeRemainingMs = coffeeTimeTotalMs - timeElapsedMs;
            
            if (coffeeTimeRemainingMs <= 0) {
                // è®¡æ—¶ç»“æŸ
                if (isCoffeeRunning) { // ä»…åœ¨åˆšåˆšç»“æŸæ—¶æ‰§è¡Œä¸€æ¬¡
                    clearInterval(coffeeTimerId);
                    isCoffeeRunning = false;
                    btn.textContent = "å®Œæˆ";
                    btn.className = "btn-reset";
                    
                    new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3').play();
                    messageElement.textContent = "â˜• å’–å•¡æ—¶é—´åˆ°ï¼è¯·äº«ç”¨ã€‚";
                }
                document.getElementById('coffee-timer-display').textContent = "00:00";
                return;
            } 
            
            // æ›´æ–°æ˜¾ç¤ºæ—¶é—´
            document.getElementById('coffee-timer-display').textContent = formatCountdownTime(coffeeTimeRemainingMs);
            
            // ç¡®ä¿è®¡æ—¶å™¨çŠ¶æ€æ­£ç¡®
            if (isCoffeeRunning && btn.textContent !== "æš‚åœ") {
                btn.textContent = "æš‚åœ";
                btn.className = "btn-pause";
            }
        }

        function setCoffeeTime() {
            const inputElement = document.getElementById('coffee-input');
            const inputSec = parseInt(inputElement.value);
            
            if (!isNaN(inputSec) && inputSec > 0) {
                clearInterval(coffeeTimerId);
                isCoffeeRunning = false;
                
                initialCoffeeTime = inputSec; // å­˜å‚¨æ–°çš„åˆå§‹å€¼ (ç§’)
                coffeeTimeTotalMs = initialCoffeeTime * 1000; // æ€»æ¯«ç§’æ•°
                coffeeTimePausedOffset = 0;
                
                // æ›´æ–°UI
                updateCoffeeDisplay();
                document.getElementById('coffeeMessage').textContent = "";
                const btn = document.getElementById('coffeeBtn');
                btn.textContent = "å¼€å§‹";
                btn.className = "btn-start";
            } else {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç§’æ•°ï¼");
            }
        }

        function resetCoffeeTimer() {
            clearInterval(coffeeTimerId);
            isCoffeeRunning = false;
            coffeeTimeTotalMs = initialCoffeeTime * 1000; // é‡ç½®æ€»æ¯«ç§’æ•°
            coffeeTimePausedOffset = 0;
            coffeeStartTime = 0;

            const btn = document.getElementById('coffeeBtn');
            btn.textContent = "å¼€å§‹";
            btn.className = "btn-start"; 
            
            document.getElementById('coffeeMessage').textContent = ""; 
            updateCoffeeDisplay(); 
        }

        function toggleCoffeeTimer() {
            const btn = document.getElementById('coffeeBtn');
            
            if (isCoffeeRunning) {
                // æš‚åœ: ç´¯åŠ æµé€æ—¶é—´åˆ° offset
                clearInterval(coffeeTimerId);
                isCoffeeRunning = false;
                coffeeTimePausedOffset += Date.now() - coffeeStartTime; // å…³é”®ï¼šè®°å½•å·²æµé€çš„æ—¶é—´
                btn.textContent = "ç»§ç»­";
                btn.className = "btn-start";
            } else {
                // å¼€å§‹/ç»§ç»­
                if (coffeeTimeTotalMs <= 0 || coffeeTimeTotalMs === undefined) {
                    setCoffeeTime(); // å¦‚æœæ€»æ—¶é—´æœªè®¾ç½®æˆ–å·²å½’é›¶ï¼Œåˆ™é‡ç½®ä¸ºåˆå§‹è®¾å®šå€¼
                }
                
                coffeeStartTime = Date.now(); // å…³é”®ï¼šè®°å½•æ–°çš„å¼€å§‹æ—¶é—´
                isCoffeeRunning = true;
                
                document.getElementById('coffeeMessage').textContent = "";
                
                coffeeTimerId = setInterval(updateCoffeeDisplay, 100); // æé«˜æ›´æ–°é¢‘ç‡ï¼ˆ100msï¼‰ä»¥å‡å°‘æ˜¾ç¤ºè·³åŠ¨
            }
            updateCoffeeDisplay();
        }

        // åˆå§‹åŒ–æ˜¾ç¤º
        updateStopwatchDisplay();
        updateCoffeeDisplay();
    
        // PWA: Service Worker æ³¨å†Œè„šæœ¬
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => { console.log('ServiceWorker registration successful with scope: ', registration.scope); })
                    .catch(error => { console.log('ServiceWorker registration failed: ', error); });
            });
        }
    </script>
</body>
</html>